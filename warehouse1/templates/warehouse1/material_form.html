{% extends 'base.html' %}
{% load static %}
{% block content %}
<main class="main">
    <section class="section editing-material container">
    <div class="section__header">
        <h1 class="section__header-title flex-center">{% if object %}{{ object.name }}{% else %}Создание материала{% endif %}</h1>
        <a href="{% if object %}{% url 'material_detail' object.pk %}{% else %}{% url 'material_list' %}{% endif %}"
        class="section__header-button button button--orange">
        Назад
        </a>
    </div>
    <form class="editing-card__form-wrapper" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
        <div class="editing-card">
        <div class="cont__header">
            <h2 class="cont__title">{% if object %}Редактирование материала{% else %}Создание материала{% endif %}</h2>
        </div>
        <div class="editing-card__body">
            <div class="editing-card__img-and-btn">
            <img
                class="editing-card__image"
                src="{% if object.image %}{{ object.image.url }}{% else %}{% static 'images/no-image.jpg' %}{% endif %}"
                height="298"
                loading="lazy"
                alt="{{ object.name }}"
            />
            <div style="display: none;">
                {{ form.image }}
            </div>
            <button class="width100 button button--orange" type="button"
            onclick="document.getElementById('{{ form.image.id_for_label }}').click()">
                Загрузить картинку
                <span class="content-size">
                <svg
                    width="25"
                    height="25"
                    viewBox="0 0 25 25"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M21.0938 7.8125V3.125C21.0938 2.69375 20.7437 2.34375 20.3125 2.34375C19.8812 2.34375 19.5312 2.69375 19.5312 3.125V7.8125C19.5312 8.24375 19.8812 8.59375 20.3125 8.59375C20.7437 8.59375 21.0938 8.24375 21.0938 7.8125Z"
                    fill="white"
                    />
                    <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M18.1977 6.80207L19.7602 8.36457C20.0654 8.66978 20.5591 8.66978 20.8643 8.36457L22.4268 6.80207C22.732 6.4979 22.732 6.00207 22.4268 5.6979C22.1227 5.39269 21.6268 5.39269 21.3227 5.6979L20.3122 6.70728L19.3018 5.6979C18.9977 5.39269 18.5018 5.39269 18.1977 5.6979C17.8924 6.00207 17.8924 6.4979 18.1977 6.80207Z"
                    fill="white"
                    />
                    <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M8.68437 22.6562H17.7083C19.0208 22.6562 20.2792 22.1354 21.2073 21.2073C22.0021 20.4115 22.499 19.374 22.625 18.2667L17.7229 14.3458C17.1823 13.9125 16.3969 13.9792 15.9365 14.4969L8.68437 22.6562ZM2.34375 15.1042V17.7083C2.34375 19.0208 2.86458 20.2792 3.79271 21.2073C4.56458 21.9781 5.56354 22.4688 6.63229 22.6125L12.4042 16.1198L8.04062 12.1531C7.57812 11.7333 6.88229 11.7 6.38333 12.075L2.34375 15.1042ZM22.6562 8.04687L21.601 9.10104C21.3823 9.32083 21.1219 9.47187 20.8448 9.55625L20.8396 9.55833C20.6865 9.60417 20.524 9.63125 20.3562 9.63437L20.3229 9.63542H20.2885L20.2687 9.63437C20.101 9.63125 19.9396 9.60417 19.7854 9.55833L19.7802 9.55625C19.5031 9.47187 19.2427 9.32083 19.024 9.10104L17.4615 7.53854C16.75 6.82708 16.75 5.67292 17.4615 4.96146C17.75 4.67188 18.1135 4.5 18.4896 4.44583V3.125C18.4896 2.87917 18.5385 2.64375 18.6271 2.43021C18.326 2.37292 18.0187 2.34375 17.7083 2.34375H7.29167C5.97917 2.34375 4.72083 2.86458 3.79271 3.79271C2.86458 4.72083 2.34375 5.97917 2.34375 7.29167V13.151L5.44583 10.825C6.54479 10 8.075 10.0729 9.09167 10.9969L13.4417 14.9521L14.7688 13.4594C15.7812 12.3198 17.5094 12.1729 18.699 13.126L22.6562 16.2917V8.04687ZM9.89583 5.20833C10.7583 5.20833 11.4583 5.90833 11.4583 6.77083C11.4583 7.63333 10.7583 8.33333 9.89583 8.33333C9.03333 8.33333 8.33333 7.63333 8.33333 6.77083C8.33333 5.90833 9.03333 5.20833 9.89583 5.20833Z"
                    fill="white"
                    />
                </svg>
                </span>
            </button>
            </div>
            <div class="editing-card__info">
            <div class="table-card-third">
                <table class="table-third">
                <tr>
                    <th><label for="{{ form.article.id_for_label }}">Артикул</label></th>
                    <td>
                    <input
                        type="text"
                        id="{{ form.article.id_for_label }}"
                        name="{{ form.article.name }}"
                        value="{{ form.article.value|default_if_none:'' }}"
                        class="form-input"
                    />
                    {% for error in form.article.errors %}<small class="text-danger">{{ error }}</small>{% endfor %}
                    </td>
                </tr>
                <tr>
                    <th><label for="{{ form.name.id_for_label }}">Название</label></th>
                    <td>
                    <input
                        type="text"
                        name="{{ form.name.name }}"
                        id="{{ form.name.id_for_label }}"
                        value="{{ form.name.value|default_if_none:'' }}"
                        class="form-input"
                    />
                    {% for error in form.name.errors %}<small class="text-danger">{{ error }}</small>{% endfor %}
                    </td>
                </tr>
                <tr>
                    <th><label for="category">Категория</label></th>
                    <td>
                    <div class="custom-dropdown-wrapper" data-dropdown>
                        <button
                        type="button"
                        class="custom-select custom-dropdown-trigger"
                        data-dropdown-trigger
                        aria-haspopup="listbox"
                        aria-expanded="false"
                        >
                        <span class="selected-product" data-dropdown-value>
                            {% if form.category.value %}
                                {% for val, label in form.category.field.choices %}
                                    {% if val|stringformat:"s" == form.category.value|stringformat:"s" %}{{ label }}{% endif %}
                                {% endfor %}
                            {% else %}
                                Выбрать категорию
                            {% endif %}
                        </span>
                        </button>
                        <ul class="select-list" data-dropdown-list role="listbox">
                            {% for val, label in form.category.field.choices %}
                                <li class="select-item" role="option" data-value="{{ val }}">{{ label }}</li>
                            {% endfor %}
                        </ul>
                        <input type="hidden" name="{{ form.category.name }}" id="{{ form.category.id_for_label }}" 
                               value="{{ form.category.value|default_if_none:'' }}" class="dropdown-hidden-input">
                    </div>
                    </div>
                    </td>
                </tr>
                <tr>
                    <th><label for="unit">Единица измерения</label></th>
                    <td>
                        <div class="custom-dropdown-wrapper" data-dropdown>
                            <button type="button" class="custom-select custom-dropdown-trigger" data-dropdown-trigger>
                                <span class="selected-product" data-dropdown-value>
                                    {% if form.unit.value %}
                                        {% for val, label in form.unit.field.choices %}
                                            {% if val|stringformat:"s" == form.unit.value|stringformat:"s" %}{{ label }}{% endif %}
                                        {% endfor %}
                                    {% else %}
                                        Выбрать категорию
                                    {% endif %}
                                </span>
                            </button>
                            <ul class="select-list" data-dropdown-list role="listbox">
                                {% for val, label in form.unit.field.choices %}
                                    <li class="select-item" role="option" data-value="{{ val }}">{{ label }}</li>
                                {% endfor %}
                            </ul>
                            <input type="hidden" name="{{ form.unit.name }}" id="{{ form.unit.id_for_label }}" 
                                   value="{{ form.unit.value|default_if_none:'' }}" class="dropdown-hidden-input">
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                    <label for="{{ form.min_quantity.id_for_label }}">Минимальное количество</label>
                    </th>
                    <td>
                    <input
                        type="number"
                        name="{{ form.min_quantity.name }}"
                        id="{{ form.min_quantity.id_for_label }}"
                        value="{{ form.min_quantity.value|default:0 }}"
                        min="0"
                        class="form-input"
                    />
                    </td>
                </tr>
                </table>
            </div>
            <textarea
                placeholder="Описание..."
                class="form-textarea"
                name="{{ form.description.name }}" 
                id="{{ form.description.id_for_label }}"
            >{{ form.description.value|default_if_none:'' }}</textarea>
            </div>
        </div>
        </div>
        <div class="editing-card__form-buttons">
        <button class="button button--blue" type="submit">Сохранить</button>
        <a href="{% url 'material_list' %}" class="button button--orange"">Отмена</a>
        </div>
    </form>
    </section>
</main>
{% endblock %}