{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üìä –°–≤–æ–¥–Ω—ã–π –ø–ª–∞–Ω –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h2>
        <a href="{% url 'workorder_list' %}" class="btn btn-outline-secondary">–ù–∞–∑–∞–¥ –∫ –¥–æ—Å–∫–µ</a>
    </div>

    <div class="alert alert-info">
        –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–∫–∞–∑–æ–≤: <strong>{{ orders_count }}</strong> 
        (ID: 
        {% for oid in order_ids %}
            <a href="{% url 'workorder_detail' oid %}" class="alert-link">#{{ oid }}</a>{% if not forloop.last %}, {% endif %}
        {% endfor %}
        )
    </div>

    <div class="card shadow">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</th>
                        <th class="text-center">–û–±—â–∏–π –ø–ª–∞–Ω (—à—Ç)</th>
                        <th class="text-center">–£–∂–µ –≤ –ø–ª–∞–Ω–µ (—à—Ç)</th>
                        <th class="text-center">–ì–æ—Ç–æ–≤–æ (—à—Ç)</th>
                        <th class="text-center">–û—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td class="fw-bold">{{ item.product__name }}</td>
                        <td class="text-center">{{ item.total_requested }}</td>
                        <td class="text-center text-muted">{{ item.total_planned }}</td>
                        <td class="text-center text-success">{{ item.total_produced }}</td>
                        <td class="text-center">
                            {% with produced=item.total_produced|default:0 requested=item.total_requested|default:0 %}
                                <span class="badge {% if produced >= requested %}bg-success{% else %}bg-danger{% endif %} fs-6">
                                    {# –ú–∞–≥–∏—è Django: —á—Ç–æ–±—ã –≤—ã—á–µ—Å—Ç—å, –Ω—É–∂–Ω–æ —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ -1 –∏ –ø—Ä–∏–±–∞–≤–∏—Ç—å #}
                                    {# –ù–æ –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –ø–µ—Ä–µ–¥–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –∏–∑ View. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å –≤ —à–∞–±–ª–æ–Ω–µ: #}
                                    {{ item.total_requested|add:item.total_produced_negative }} 
                                    {% if item.total_requested <= item.total_produced %}0{% endif %}
                                </span>
                            {% endwith %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mt-4 no-print">
        <button onclick="window.print()" class="btn btn-secondary">
            <i class="bi bi-printer"></i> –ü–µ—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è
        </button>
    </div>
</div>
{% endblock %}