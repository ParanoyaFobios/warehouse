{% extends "base.html" %}
{% load main_tags %}
{% block content %}
<main class="main">
    <section class="section catalog-products container">
    <div class="section__header">
        <h1 class="section__header-title flex-center">
        Каталог продукции
        <span class="content-size">
            <svg
            width="30"
            height="30"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            >
            <path
                d="M29.3487 18.0215V25.547L22.8336 29.3085V21.783L29.3487 18.0215ZM21.5172 4.45461L15 0.691895L8.48277 4.45461L15 8.21738L21.5172 4.45461ZM15 21.876C12.4169 21.876 10.3228 19.7819 10.3228 17.1988C10.3228 14.6156 12.4169 12.5215 15 12.5215C17.5831 12.5215 19.6773 14.6156 19.6773 17.1988C19.6773 19.7819 17.5831 21.876 15 21.876ZM17.3552 15.2639C17.0828 15.0308 16.6731 15.0627 16.44 15.3351L14.4508 17.6557L13.5505 16.6531C13.3105 16.3863 12.8996 16.3647 12.6329 16.6048C12.3662 16.8448 12.3446 17.2557 12.5846 17.5224L13.9788 19.075C14.2507 19.3772 14.7295 19.3561 14.9761 19.0375L17.4263 16.1789C17.6594 15.9066 17.6275 15.497 17.3552 15.2639ZM15.4395 22.7376V25.547L21.9546 29.3085V21.783L19.5465 20.3926C18.6201 21.7088 17.1369 22.6047 15.4395 22.7376ZM10.4536 20.3926L8.04543 21.783V29.3085L14.5606 25.547V22.7376C12.8631 22.6048 11.38 21.7088 10.4536 20.3926ZM22.3941 13.4988L20.0399 14.858C20.371 15.5694 20.5562 16.3624 20.5562 17.1988C20.5562 18.0738 20.3536 18.9016 19.993 19.6379L22.3942 21.0242L28.9114 17.2615L22.3941 13.4988ZM9.44389 17.1988C9.44389 16.3625 9.6291 15.5695 9.96016 14.858L7.60598 13.4988L1.08877 17.2616L7.60598 21.0243L10.0071 19.638C9.6465 18.9017 9.44389 18.0739 9.44389 17.1988ZM0.651367 25.547L7.16646 29.3085V21.783L0.651367 18.0215V25.547ZM15.4395 11.6599C17.1752 11.7958 18.6872 12.7295 19.6086 14.0946L21.9546 12.7401V5.21457L15.4395 8.97611V11.6599ZM14.5606 11.6599V8.97611L8.04543 5.21457V12.7401L10.3915 14.0946C11.3129 12.7295 12.8248 11.7958 14.5606 11.6599Z"
                fill="#00A6F2"
            />
            </svg>
        </span>
        </h1>
        <div class="section__header-buttons-cont">
        <a href="{% url 'product_create' %}" class="section__header-button button button--blue">
            Добавить товар +
        </a>
        <a href="{% url 'sync_products' %}" class="section__header-button button button--blue">
            Добавить товар из KeyCRM
        </a>
        <a href="{% url 'product_incoming' %}" class="section__header-button button button--orange">
            Принять товар +
        </a>
        </div>
    </div>
    <div class="sorting">
        <div class="sorting__active-archive">

            <!--поменять кнопку на ссылку-->
        <a href="{% url 'product_list' %}" class="sorting__active-archive-button button--{% if not is_archived_view %}active{% endif %}"
        type="button"
        >
            Активные
        </a>
        <a href="{% url 'product_list' %}?archived=1"
            class="sorting__active-archive-button button sorting__active-archive-button--{% if is_archived_view %}active{% endif %}"
        type="button"
            >
            Архив
        </a>
            <!--поменять кнопку на ссылку-->

        </div>
        <form class="sorting__filtration" method="get" id="filter-form">
        <div
            class="custom-dropdown-wrapper custom-dropdown-wrapper--in-sorting"
            data-dropdown
        >
            <button
            type="button"
            class="custom-select custom-dropdown-trigger custom-dropdown-trigger--in-sorting"
            data-dropdown-trigger
            aria-haspopup="listbox"
            aria-expanded="false"
            >
            <span class="selected-product" data-dropdown-value>
                {% if request.GET.category %}
                  {% for category in categories %}
                    {% if request.GET.category == category.id|stringformat:"s" %}{{ category.name }}{% endif %}
                  {% endfor %}
                {% else %}
                  Все категории
                {% endif %}
              </span>
            </button>

            <ul
            class="select-list"
            data-dropdown-list
            role="listbox"
            tabindex="-1"
          >
            <li class="select-item" role="option" data-value="">
              Все категории
            </li>
            {% for category in categories %}
              <li 
                class="select-item" 
                role="option" 
                data-value="{{ category.id }}"
              >
                {{ category.name }}
              </li>
            {% endfor %}
          </ul>
            <input
            type="hidden"
            id="category"
            name="category"
            value="pillows"
            class="dropdown-hidden-input"
            />
        </div>
        <div class="sorting__filtration-buttons flex-center">
            <button
            type="submit"
            class="sorting__filtration-button button button--blue"
            >
            <span
                class="sorting__filtration-button-icon-wrapper content-size"
            >
                <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                >
                <g clip-path="url(#clip0_856_4225)">
                    <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M6.57918 0.520508C5.46619 0.520508 4.51413 1.24707 4.15269 2.24362H1.40816C0.931874 2.24362 0.545765 2.62973 0.545765 3.10602C0.545765 3.58231 0.931874 3.96842 1.40816 3.96842H4.15101C4.51103 4.96588 5.46431 5.69153 6.57918 5.69153C7.69393 5.69153 8.64219 4.96571 9.00063 3.96842H18.6376C19.1139 3.96842 19.5 3.58231 19.5 3.10602C19.5 2.62973 19.1139 2.24362 18.6376 2.24362H8.99894C8.63909 1.24725 7.69205 0.520508 6.57918 0.520508ZM10.0271 7.41464C8.91179 7.41464 7.95693 8.13967 7.59723 9.13775H1.40816C1.37845 9.13621 1.34869 9.13621 1.31898 9.13775C0.842689 9.16238 0.476546 9.56845 0.501173 10.0447C0.525801 10.521 0.931874 10.8872 1.40816 10.8625H7.6006C7.96224 11.8587 8.91436 12.5857 10.0271 12.5857C11.1398 12.5857 12.0869 11.8587 12.4469 10.8625H18.6376C19.1139 10.8625 19.5 10.4764 19.5 10.0001C19.5 9.52386 19.1139 9.13775 18.6376 9.13775H12.4502C12.0922 8.13967 11.1424 7.41464 10.0271 7.41464ZM13.4666 14.3088C12.3513 14.3088 11.4015 15.0338 11.0435 16.0319H1.40816C1.37845 16.0303 1.34869 16.0303 1.31898 16.0319C0.842689 16.0565 0.476545 16.4626 0.501173 16.9389C0.525801 17.4152 0.931874 17.7813 1.40816 17.7567H11.0468C11.4068 18.7528 12.3539 19.4798 13.4666 19.4798C14.5793 19.4798 15.5314 18.7528 15.8931 17.7567H18.6376C19.1139 17.7567 19.5 17.3706 19.5 16.8943C19.5 16.418 19.1139 16.0319 18.6376 16.0319H15.8964C15.5367 15.0338 14.5819 14.3088 13.4666 14.3088Z"
                    fill="white"
                    />
                </g>
                <defs>
                    <clipPath id="clip0_856_4225">
                    <rect width="20" height="20" fill="white" />
                    </clipPath>
                </defs>
                </svg>
            </span>
            <span class="sorting__filtration-button-text">Фильтровать</span>
            </button>
            <a
            href="{{ request.path }}"
            class="sorting__filtration-button button button--orange"
            style="text-decoration: none;"
          >
            <span class="sorting__filtration-button-icon-wrapper content-size">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_856_4228)">
                  <path d="M19.891 10.9234L16.4064 16.518C16.2832 16.7158 16.0978 16.8293 15.8978 16.8293C15.6982 16.8293 15.5133 16.7162 15.3904 16.5189L11.9059 10.9235C11.7793 10.7203 11.7621 10.504 11.8587 10.33C11.955 10.1566 12.1467 10.0572 12.3847 10.0572L14.8505 10.0572C14.8507 10.0384 14.8512 10.0196 14.8512 10.0007C14.8512 6.4579 11.9689 3.5756 8.42604 3.5756C4.88322 3.57559 2.00092 6.4579 2.00092 10.0007C2.00091 13.5435 4.88327 16.4258 8.4261 16.4258C9.51464 16.4258 10.5897 16.1489 11.5351 15.6251C12.0183 15.3573 12.6273 15.5321 12.8951 16.0153C13.1629 16.4986 12.9882 17.1075 12.5049 17.3753C11.2635 18.0632 9.85311 18.4268 8.4261 18.4268C3.77994 18.4268 6.60896e-07 14.6469 1.47326e-06 10.0007C2.28561e-06 5.35457 3.77995 1.57462 8.4261 1.57462C13.0723 1.57463 16.8522 5.35457 16.8522 10.0007C16.8522 10.0196 16.8517 10.0383 16.8516 10.0572L19.4123 10.0572C19.6502 10.0572 19.8419 10.1566 19.9382 10.33C20.0348 10.504 20.0176 10.7203 19.891 10.9234Z"
                  fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_856_4228"><rect width="20" height="20" fill="white" /></clipPath>
                </defs>
              </svg>
            </span>
            <span class="sorting__filtration-button-text">Сбросить</span>
          </a>
        </div>
        </form>
    </div>
    <div class="tables-cont tables-cont--first-type tables-cont--m-t-10-20">
        <ul class="cont__list">
            {% for product in products %}
        <li class="cont__item">
            <article class="table-card-first">
            <h1 class="table-card-first__title"><a href="{% url 'product_detail' product.pk %}">{{ product.name }}</a></h1>
            <table class="table-first">
                <tr class="table__row">
                <th>Артикул</th>
                <td>{{ product.sku }}</td>
                </tr>
                <tr class="table__row">
                <th>Категория</th>
                <td>{{ product.category }}</td>
                </tr>
                <tr class="table__row">
                <th>Цвет</th>
                <td>{{ product.color|default:"-" }}</td>
                </tr>
                {% if perms.can_view_product_quantity %}
                <tr class="table__row">
                <th>На складе</th>
                <td>{{ product.total_quantity }}</td>
                </tr>
                <tr class="table__row">
                <th>Доступно</th>
                <td>{{ product.available_quantity }}</td>
                {% endif %}
                </tr>
                <tr
                class="table__row table__row--color table__row--color-string"
                >
                <th>Цена</th>
                <td>{{ product.price }} грн</td>
                </tr>
                <tr class="table__row">
                <td>
                    <a class="table__color-text" href="{% url 'barcode_display_page' content_type_id=product.get_content_type_id object_id=product.pk %}">
                    <span class="content-size">
                        <svg
                        width="30"
                        height="30"
                        viewBox="0 0 30 30"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        >
                        <rect
                            width="30"
                            height="30"
                            rx="3"
                            fill="#00A6F2"
                            fill-opacity="0.6"
                        />
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M27 15.116V20.567C27 20.9431 26.6868 21.2484 26.301 21.2484H15.8808C15.495 21.2484 15.1818 20.9431 15.1818 20.567V15.116C15.1818 14.7399 15.495 14.4346 15.8808 14.4346H26.301C26.6868 14.4346 27 14.7399 27 15.116ZM18.5346 15.6417C18.5346 15.5992 18.5173 15.5585 18.4865 15.5285C18.4558 15.4985 18.414 15.4816 18.3705 15.4816H17.6635C17.62 15.4816 17.5782 15.4985 17.5474 15.5285C17.5166 15.5585 17.4993 15.5992 17.4993 15.6417V20.0413C17.4993 20.0838 17.5166 20.1245 17.5474 20.1545C17.5782 20.1845 17.62 20.2014 17.6635 20.2014H18.3705C18.414 20.2014 18.4558 20.1845 18.4865 20.1545C18.5173 20.1245 18.5346 20.0838 18.5346 20.0413V15.6417ZM21.2586 15.7797V19.9033C21.2586 20.0678 21.4154 20.2014 21.6086 20.2014C21.8017 20.2014 21.9586 20.0678 21.9586 19.9033V15.7797C21.9586 15.6152 21.8017 15.4816 21.6086 15.4816C21.4154 15.4816 21.2586 15.6152 21.2586 15.7797ZM22.5279 15.7797V19.9033C22.5279 20.0678 22.6847 20.2014 22.8779 20.2014C23.0711 20.2014 23.2279 20.0678 23.2279 19.9033V15.7797C23.2279 15.6152 23.0711 15.4816 22.8779 15.4816C22.6847 15.4816 22.5279 15.6152 22.5279 15.7797ZM24.6825 15.6417C24.6825 15.5992 24.6652 15.5585 24.6344 15.5285C24.6037 15.4985 24.5619 15.4816 24.5184 15.4816H23.8114C23.7679 15.4816 23.7261 15.4985 23.6953 15.5285C23.6645 15.5585 23.6472 15.5992 23.6472 15.6417V20.0413C23.6472 20.0838 23.6645 20.1245 23.6953 20.1545C23.7261 20.1845 23.7679 20.2014 23.8114 20.2014H24.5184C24.5619 20.2014 24.6037 20.1845 24.6344 20.1545C24.6652 20.1245 24.6825 20.0838 24.6825 20.0413V15.6417ZM25.3518 15.7797V19.9033C25.3518 20.0678 25.5087 20.2014 25.7018 20.2014C25.895 20.2014 26.0518 20.0678 26.0518 19.9033V15.7797C26.0518 15.6152 25.895 15.4816 25.7018 15.4816C25.5087 15.4816 25.3518 15.6152 25.3518 15.7797ZM20.5892 15.6417C20.5892 15.5992 20.5719 15.5585 20.5412 15.5285C20.5104 15.4985 20.4686 15.4816 20.4251 15.4816H19.7181C19.6746 15.4816 19.6328 15.4985 19.602 15.5285C19.5713 15.5585 19.554 15.5992 19.554 15.6417V20.0413C19.554 20.0838 19.5713 20.1245 19.602 20.1545C19.6328 20.1845 19.6746 20.2014 19.7181 20.2014H20.4251C20.4686 20.2014 20.5104 20.1845 20.5412 20.1545C20.5719 20.1245 20.5892 20.0838 20.5892 20.0413V15.6417ZM16.13 15.7797V19.9033C16.13 20.0678 16.2868 20.2014 16.48 20.2014C16.6732 20.2014 16.83 20.0678 16.83 19.9033V15.7797C16.83 15.6152 16.6732 15.4816 16.48 15.4816C16.2868 15.4816 16.13 15.6152 16.13 15.7797ZM13.0796 15.1709L13.6276 15.2709C13.85 15.3115 13.9969 15.5205 13.9552 15.7374L13.531 17.9466C13.4894 18.1635 13.2749 18.3067 13.0524 18.2661L12.4904 18.1635C12.6638 17.2827 12.8968 16.0997 13.0796 15.1709ZM12.6844 13.558L11.552 19.3096C11.4705 19.9519 11.6674 20.5983 12.0953 21.0932C12.332 21.3669 13.0172 21.5909 13.5823 21.7365C14.0738 21.8627 14.4162 22.296 14.4162 22.7915C14.4169 23.0092 14.4169 23.237 14.4169 23.4355C14.4169 23.7472 14.1576 24 13.8378 24H6.80621C6.64096 24 6.48351 23.9311 6.37361 23.8108C6.26376 23.6905 6.21186 23.5301 6.23101 23.37L7.40571 13.558H12.6844ZM16.2726 12.8757H5.26861C4.40921 12.8757 3.62361 12.4023 3.23941 11.653C2.85516 10.9037 2.93826 10.0071 3.45406 9.33708L4.79661 7.59299C5.56861 6.59014 6.77981 6 8.06601 6H16.2726V12.8757ZM19.221 6.8468V12.0289C19.221 12.2534 19.1294 12.4689 18.9665 12.6277C18.8036 12.7865 18.5826 12.8757 18.3523 12.8757H16.9726V6H18.3523C18.5826 6 18.8036 6.08924 18.9665 6.24803C19.1294 6.40683 19.221 6.62221 19.221 6.8468Z"
                            fill="white"
                        />
                        </svg>
                    </span>
                    <span>{{ product.barcode }}</span>
                    </a>
                </td>
                </tr>
                <tr class="table__row">
                </tr>
            </table>
            </article>
        </li>
        {% empty %}
        <h1 class="section__header-title flex-center">
            Продукты не найдены
        </h1>
        {% endfor %}

        </ul>

    {% if is_paginated %}
    <div class="pagination">
      <!-- для выделения активной кнопки добавляем кнопке класс pagination__button--active -->
      <div class="pagination__block">
        {% if page_obj.has_previous %}
        <a class="pagination__button" href="?page=1&category={{ current_category }}&search={{ current_search }}">
          <span class="content-size">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11.8497 17.5C11.859 17.5 11.864 17.4888 11.8572 17.4819L4.37528 10L11.8572 2.51812C11.864 2.51125 11.859 2.5 11.8497 2.5H8.75028L1.38278 9.8675C1.30965 9.94063 1.30965 10.0594 1.38278 10.1325L8.75028 17.5H11.8497Z"
                fill="white"
              />
              <path
                d="M18.7247 17.5C18.734 17.5 18.739 17.4888 18.7322 17.4819L11.2503 10L18.7322 2.51812C18.739 2.51125 18.734 2.5 18.7247 2.5H15.6253L8.25778 9.8675C8.18465 9.94063 8.18465 10.0594 8.25778 10.1325L15.6253 17.5H18.7247Z"
                fill="white"
              />
            </svg>
          </span>
        </a>
        <a class="pagination__button" href="?page={{ page_obj.previous_page_number }}&category={{ current_category }}&search={{ current_search }}">
          <span class="content-size">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14.9903 17.5C14.9997 17.5 15.0047 17.4888 14.9978 17.4819L7.5159 10L14.9978 2.51812C15.0047 2.51125 14.9997 2.5 14.9903 2.5H11.8909L4.5234 9.8675C4.45028 9.94063 4.45028 10.0594 4.5234 10.1325L11.8909 17.5H14.9903Z"
                fill="white"
              />
            </svg>
          </span>
        </a>
        {% endif %}
      </div>

  <div class="pagination__block">
  {% for num in page_obj.paginator.page_range %}
  {% if page_obj.number == num %}
        <button
          class="pagination__button pagination__button--active"
          type="button"
        >
          <span class="content-size">{{ num }}</span>
        </button>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
        <a href="?page={{ num }}&category={{ current_category }}&search={{ current_search }}"
        class="pagination__button pagination__button"
        type="button"
      >
        <span class="content-size">{{ num }}</span>
      </a>
      {% endif %}
      {% endfor %}
  </div>

  {% if page_obj.has_next %}
      <div class="pagination__block">
        <a class="pagination__button" href="?page={{ page_obj.next_page_number }}&category={{ current_category }}&search={{ current_search }}">
          <span class="content-size">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M5.00972 17.5C5.00035 17.5 4.99535 17.4888 5.00222 17.4819L12.4841 10L5.00222 2.51812C4.99535 2.51125 5.00035 2.5 5.00972 2.5H8.1091L15.4766 9.8675C15.5497 9.94063 15.5497 10.0594 15.4766 10.1325L8.1091 17.5H5.00972Z"
                fill="white"
              />
            </svg>
          </span>
        </a>


        <a class="pagination__button" href="?page={{ page_obj.paginator.num_pages }}&category={{ current_category }}&search={{ current_search }}">
          <span class="content-size">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.15035 17.5C8.14097 17.5 8.13597 17.4888 8.14285 17.4819L15.6247 10L8.14285 2.51812C8.13597 2.51125 8.14097 2.5 8.15035 2.5H11.2497L18.6172 9.8675C18.6903 9.94063 18.6903 10.0594 18.6172 10.1325L11.2497 17.5H8.15035Z"
                fill="white"
              />
              <path
                d="M1.27535 17.5C1.26597 17.5 1.26097 17.4888 1.26785 17.4819L8.74972 10L1.26785 2.51812C1.26097 2.51125 1.26597 2.5 1.27535 2.5H4.37472L11.7422 9.8675C11.8153 9.94063 11.8153 10.0594 11.7422 10.1325L4.37472 17.5H1.27535Z"
                fill="white"
              />
            </svg>
          </span>
        </a>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</section>
</main>
  {% endblock %}