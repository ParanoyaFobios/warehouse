{% extends "base.html" %}
{% load main_tags %}
{% load static %}
{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-6">
            <h2>{{ product.name }}</h2>
            {% if product.image %}
            <img src="{{ product.get_image_url }}" class="img-fluid mb-3" alt="{{ product.name }}">
            {% endif %}
            <table class="table table-sm table-striped">
                <tbody>
                    <tr><th>–ê—Ä—Ç–∏–∫—É–ª:</th><td>{{ product.sku }}</td></tr>
                    <tr><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</th><td>{{ product.category }}</td></tr>
                    <tr><th>–¶–≤–µ—Ç</th><td>{{ product.color }}</td></tr>
                    <tr><th>–¶–µ–Ω–∞</th><td>{{ product.price }}</td></tr>
                    {% if perms.can_view_product_quantity %}
                    <tr><th>–ù–∞ —Å–∫–ª–∞–¥–µ:</th><td>{{ product.total_quantity }}</td></tr>
                    <tr class="table-info"><th>–î–æ—Å—Ç—É–ø–Ω–æ:</th><td class="fw-bold">{{ product.available_quantity }}</td></tr>
                    {% endif %}
                    <tr><th>–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ:</th><td>{{ product.reserved_quantity }}</td></tr>
                </tbody>
            </table>
            <a href="{% url 'product_edit' product.pk %}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</a>
            {% if product.pk %}
            <form action="{% url 'product_archive' product.pk %}" method="post" style="display:inline;">
                {% csrf_token %}
                {% if product.is_archived %}
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-arrow-up-circle"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞
                    </button>
                {% else %}
                    <button type="submit" class="btn btn-warning" onclick="return confirm('–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')">
                        <i class="bi bi-archive"></i> –í –∞—Ä—Ö–∏–≤
                    </button>
                {% endif %}
            </form>
            {% endif %}
            <a href="{% url 'product_list' %}" class="btn btn-secondary btn-sm">–ö —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤</a>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header"><h5>–®—Ç—Ä–∏—Ö–∫–æ–¥ (—à—Ç—É—á–Ω—ã–π)</h5></div>
                <div class="card-body text-center">
                    <a class="table__color-text" href="{% url 'barcode_display_page' content_type_id=product.get_content_type_id object_id=product.pk %}">
                    <img src="{% url 'generate_barcode_image' content_type_id=product.get_content_type_id object_id=product.pk %}" alt="–®—Ç—Ä–∏—Ö–∫–æ–¥" class="img-fluid mb-2">
                    <p class="mt-2 font-monospace">{{ product.barcode }}</p>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <div class="row">
        <div class="col-md-4">
            <h4>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É</h4>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>

        <div class="col-md-8">
            <h4>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–ø–∞–∫–æ–≤–∫–∏</h4>
            {% if packages %}
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ/–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–ö–æ–ª-–≤–æ</th>
                            <th>–®—Ç—Ä–∏—Ö–∫–æ–¥</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for package in packages %}
                        <tr>
                            <td>{{ package }}</a></td>
                            <td>{{ package.quantity }} —à—Ç.</td>
                            <td class="font-monospace"><a href="{% url 'barcode_display_page' content_type_id=package.get_content_type_id object_id=package.pk %}" alt="–®—Ç—Ä–∏—Ö–∫–æ–¥" class="img-fluid mb-2">{{ package.barcode }}</a></td>
                            <td>
                                <a href="{% url 'package_edit' package.pk %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
                                <a href="{% url 'package_delete' package.pk %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">–î–ª—è —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}